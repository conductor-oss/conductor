import com.fasterxml.jackson.databind.JsonNode
import com.fasterxml.jackson.databind.ObjectMapper
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.Assertions

public class TestSerDerWorkflowTask {

    @Test
    public void testSerializationDeserialization() throws Exception {
        String serverJSON = "{\"joinOn\":[\"sample_joinOn\"],\"description\":\"sample_description\",\"scriptExpression\":\"sample_scriptExpression\",\"cacheConfig\":{\"key\":\"sample_key\",\"ttlInSecond\":123},\"type\":\"sample_type\",\"inputParameters\":{\"sample_key\":\"sample_value\"},\"decisionCases\":{\"sample_key\":[{\"joinOn\":[\"sample_joinOn\"],\"description\":\"sample_description\",\"scriptExpression\":\"sample_scriptExpression\",\"cacheConfig\":{\"key\":\"sample_key\",\"ttlInSecond\":123},\"type\":\"sample_type\",\"inputParameters\":{\"sample_key\":\"sample_value\"},\"decisionCases\":{},\"loopOver\":[],\"caseExpression\":\"sample_caseExpression\",\"defaultExclusiveJoinTask\":[\"sample_defaultExclusiveJoinTask\"],\"taskDefinition\":{\"timeoutPolicy\":{\"values\":[\"RETRY\",\"TIME_OUT_WF\",\"ALERT_ONLY\"],\"constants\":{\"ALERT_ONLY\":\"(2)\",\"TIME_OUT_WF\":\"(1)\",\"RETRY\":\"(0)\"},\"sampleValue\":\"RETRY\"},\"inputKeys\":[\"sample_inputKeys\"],\"concurrentExecLimit\":123,\"isolationGroupId\":\"sample_isolationGroupId\",\"retryCount\":123,\"description\":\"sample_description\",\"inputTemplate\":{\"sample_key\":\"sample_value\"},\"ownerEmail\":\"sample_ownerEmail\",\"baseType\":\"sample_baseType\",\"totalTimeoutSeconds\":123,\"retryDelaySeconds\":123,\"backoffScaleFactor\":123,\"rateLimitPerFrequency\":123,\"retryLogic\":{\"values\":[\"FIXED\",\"EXPONENTIAL_BACKOFF\",\"LINEAR_BACKOFF\"],\"constants\":{\"EXPONENTIAL_BACKOFF\":\"(1)\",\"FIXED\":\"(0)\",\"LINEAR_BACKOFF\":\"(2)\"},\"sampleValue\":\"FIXED\"},\"responseTimeoutSeconds\":123,\"name\":\"sample_name\",\"timeoutSeconds\":123,\"rateLimitFrequencyInSeconds\":123,\"outputKeys\":[\"sample_outputKeys\"],\"executionNameSpace\":\"sample_executionNameSpace\",\"pollTimeoutSeconds\":123},\"caseValueParam\":\"sample_caseValueParam\",\"dynamicForkTasksInputParamName\":\"sample_dynamicForkTasksInputParamName\",\"expression\":\"sample_expression\",\"loopCondition\":\"sample_loopCondition\",\"asyncComplete\":true,\"sink\":\"sample_sink\",\"rateLimited\":true,\"retryCount\":123,\"subWorkflowParam\":{\"workflowDefinition\":\"sample_workflowDefinition\",\"idempotencyKey\":\"sample_idempotencyKey\",\"name\":\"sample_name\",\"taskToDomain\":{\"sample_key\":\"sample_value\"},\"priority\":\"sample_object_priority\",\"version\":123,\"idempotencyStrategy\":{\"values\":[\"FAIL\",\"RETURN_EXISTING\",\"FAIL_ON_RUNNING\"],\"constants\":{\"FAIL_ON_RUNNING\":\"(2)\",\"RETURN_EXISTING\":\"(1)\",\"FAIL\":\"(0)\"},\"sampleValue\":\"FAIL\"}},\"optional\":true,\"joinStatus\":\"sample_joinStatus\",\"evaluatorType\":\"sample_evaluatorType\",\"dynamicTaskNameParam\":\"sample_dynamicTaskNameParam\",\"name\":\"sample_name\",\"startDelay\":123,\"permissive\":true,\"taskReferenceName\":\"sample_taskReferenceName\",\"defaultCase\":[],\"forkTasks\":[[]],\"dynamicForkTasksParam\":\"sample_dynamicForkTasksParam\"}]},\"loopOver\":[{\"joinOn\":[\"sample_joinOn\"],\"description\":\"sample_description\",\"scriptExpression\":\"sample_scriptExpression\",\"cacheConfig\":{\"key\":\"sample_key\",\"ttlInSecond\":123},\"type\":\"sample_type\",\"inputParameters\":{\"sample_key\":\"sample_value\"},\"decisionCases\":{},\"loopOver\":[],\"caseExpression\":\"sample_caseExpression\",\"defaultExclusiveJoinTask\":[\"sample_defaultExclusiveJoinTask\"],\"taskDefinition\":{\"timeoutPolicy\":{\"values\":[\"RETRY\",\"TIME_OUT_WF\",\"ALERT_ONLY\"],\"constants\":{\"ALERT_ONLY\":\"(2)\",\"TIME_OUT_WF\":\"(1)\",\"RETRY\":\"(0)\"},\"sampleValue\":\"RETRY\"},\"inputKeys\":[\"sample_inputKeys\"],\"concurrentExecLimit\":123,\"isolationGroupId\":\"sample_isolationGroupId\",\"retryCount\":123,\"description\":\"sample_description\",\"inputTemplate\":{\"sample_key\":\"sample_value\"},\"ownerEmail\":\"sample_ownerEmail\",\"baseType\":\"sample_baseType\",\"totalTimeoutSeconds\":123,\"retryDelaySeconds\":123,\"backoffScaleFactor\":123,\"rateLimitPerFrequency\":123,\"retryLogic\":{\"values\":[\"FIXED\",\"EXPONENTIAL_BACKOFF\",\"LINEAR_BACKOFF\"],\"constants\":{\"EXPONENTIAL_BACKOFF\":\"(1)\",\"FIXED\":\"(0)\",\"LINEAR_BACKOFF\":\"(2)\"},\"sampleValue\":\"FIXED\"},\"responseTimeoutSeconds\":123,\"name\":\"sample_name\",\"timeoutSeconds\":123,\"rateLimitFrequencyInSeconds\":123,\"outputKeys\":[\"sample_outputKeys\"],\"executionNameSpace\":\"sample_executionNameSpace\",\"pollTimeoutSeconds\":123},\"caseValueParam\":\"sample_caseValueParam\",\"dynamicForkTasksInputParamName\":\"sample_dynamicForkTasksInputParamName\",\"expression\":\"sample_expression\",\"loopCondition\":\"sample_loopCondition\",\"asyncComplete\":true,\"sink\":\"sample_sink\",\"rateLimited\":true,\"retryCount\":123,\"subWorkflowParam\":{\"workflowDefinition\":\"sample_workflowDefinition\",\"idempotencyKey\":\"sample_idempotencyKey\",\"name\":\"sample_name\",\"taskToDomain\":{\"sample_key\":\"sample_value\"},\"priority\":\"sample_object_priority\",\"version\":123,\"idempotencyStrategy\":{\"values\":[\"FAIL\",\"RETURN_EXISTING\",\"FAIL_ON_RUNNING\"],\"constants\":{\"FAIL_ON_RUNNING\":\"(2)\",\"RETURN_EXISTING\":\"(1)\",\"FAIL\":\"(0)\"},\"sampleValue\":\"FAIL\"}},\"optional\":true,\"joinStatus\":\"sample_joinStatus\",\"evaluatorType\":\"sample_evaluatorType\",\"dynamicTaskNameParam\":\"sample_dynamicTaskNameParam\",\"name\":\"sample_name\",\"startDelay\":123,\"permissive\":true,\"taskReferenceName\":\"sample_taskReferenceName\",\"defaultCase\":[],\"forkTasks\":[[]],\"dynamicForkTasksParam\":\"sample_dynamicForkTasksParam\"}],\"caseExpression\":\"sample_caseExpression\",\"defaultExclusiveJoinTask\":[\"sample_defaultExclusiveJoinTask\"],\"taskDefinition\":{\"timeoutPolicy\":{\"values\":[\"RETRY\",\"TIME_OUT_WF\",\"ALERT_ONLY\"],\"constants\":{\"ALERT_ONLY\":\"(2)\",\"TIME_OUT_WF\":\"(1)\",\"RETRY\":\"(0)\"},\"sampleValue\":\"RETRY\"},\"inputKeys\":[\"sample_inputKeys\"],\"concurrentExecLimit\":123,\"isolationGroupId\":\"sample_isolationGroupId\",\"retryCount\":123,\"description\":\"sample_description\",\"inputTemplate\":{\"sample_key\":\"sample_value\"},\"ownerEmail\":\"sample_ownerEmail\",\"baseType\":\"sample_baseType\",\"totalTimeoutSeconds\":123,\"retryDelaySeconds\":123,\"backoffScaleFactor\":123,\"rateLimitPerFrequency\":123,\"retryLogic\":{\"values\":[\"FIXED\",\"EXPONENTIAL_BACKOFF\",\"LINEAR_BACKOFF\"],\"constants\":{\"EXPONENTIAL_BACKOFF\":\"(1)\",\"FIXED\":\"(0)\",\"LINEAR_BACKOFF\":\"(2)\"},\"sampleValue\":\"FIXED\"},\"responseTimeoutSeconds\":123,\"name\":\"sample_name\",\"timeoutSeconds\":123,\"rateLimitFrequencyInSeconds\":123,\"outputKeys\":[\"sample_outputKeys\"],\"executionNameSpace\":\"sample_executionNameSpace\",\"pollTimeoutSeconds\":123},\"caseValueParam\":\"sample_caseValueParam\",\"dynamicForkTasksInputParamName\":\"sample_dynamicForkTasksInputParamName\",\"expression\":\"sample_expression\",\"loopCondition\":\"sample_loopCondition\",\"asyncComplete\":true,\"sink\":\"sample_sink\",\"rateLimited\":true,\"retryCount\":123,\"subWorkflowParam\":{\"workflowDefinition\":\"sample_workflowDefinition\",\"idempotencyKey\":\"sample_idempotencyKey\",\"name\":\"sample_name\",\"taskToDomain\":{\"sample_key\":\"sample_value\"},\"priority\":\"sample_object_priority\",\"version\":123,\"idempotencyStrategy\":{\"values\":[\"FAIL\",\"RETURN_EXISTING\",\"FAIL_ON_RUNNING\"],\"constants\":{\"FAIL_ON_RUNNING\":\"(2)\",\"RETURN_EXISTING\":\"(1)\",\"FAIL\":\"(0)\"},\"sampleValue\":\"FAIL\"}},\"optional\":true,\"joinStatus\":\"sample_joinStatus\",\"evaluatorType\":\"sample_evaluatorType\",\"dynamicTaskNameParam\":\"sample_dynamicTaskNameParam\",\"name\":\"sample_name\",\"startDelay\":123,\"permissive\":true,\"taskReferenceName\":\"sample_taskReferenceName\",\"defaultCase\":[{\"joinOn\":[\"sample_joinOn\"],\"description\":\"sample_description\",\"scriptExpression\":\"sample_scriptExpression\",\"cacheConfig\":{\"key\":\"sample_key\",\"ttlInSecond\":123},\"type\":\"sample_type\",\"inputParameters\":{\"sample_key\":\"sample_value\"},\"decisionCases\":{},\"loopOver\":[],\"caseExpression\":\"sample_caseExpression\",\"defaultExclusiveJoinTask\":[\"sample_defaultExclusiveJoinTask\"],\"taskDefinition\":{\"timeoutPolicy\":{\"values\":[\"RETRY\",\"TIME_OUT_WF\",\"ALERT_ONLY\"],\"constants\":{\"ALERT_ONLY\":\"(2)\",\"TIME_OUT_WF\":\"(1)\",\"RETRY\":\"(0)\"},\"sampleValue\":\"RETRY\"},\"inputKeys\":[\"sample_inputKeys\"],\"concurrentExecLimit\":123,\"isolationGroupId\":\"sample_isolationGroupId\",\"retryCount\":123,\"description\":\"sample_description\",\"inputTemplate\":{\"sample_key\":\"sample_value\"},\"ownerEmail\":\"sample_ownerEmail\",\"baseType\":\"sample_baseType\",\"totalTimeoutSeconds\":123,\"retryDelaySeconds\":123,\"backoffScaleFactor\":123,\"rateLimitPerFrequency\":123,\"retryLogic\":{\"values\":[\"FIXED\",\"EXPONENTIAL_BACKOFF\",\"LINEAR_BACKOFF\"],\"constants\":{\"EXPONENTIAL_BACKOFF\":\"(1)\",\"FIXED\":\"(0)\",\"LINEAR_BACKOFF\":\"(2)\"},\"sampleValue\":\"FIXED\"},\"responseTimeoutSeconds\":123,\"name\":\"sample_name\",\"timeoutSeconds\":123,\"rateLimitFrequencyInSeconds\":123,\"outputKeys\":[\"sample_outputKeys\"],\"executionNameSpace\":\"sample_executionNameSpace\",\"pollTimeoutSeconds\":123},\"caseValueParam\":\"sample_caseValueParam\",\"dynamicForkTasksInputParamName\":\"sample_dynamicForkTasksInputParamName\",\"expression\":\"sample_expression\",\"loopCondition\":\"sample_loopCondition\",\"asyncComplete\":true,\"sink\":\"sample_sink\",\"rateLimited\":true,\"retryCount\":123,\"subWorkflowParam\":{\"workflowDefinition\":\"sample_workflowDefinition\",\"idempotencyKey\":\"sample_idempotencyKey\",\"name\":\"sample_name\",\"taskToDomain\":{\"sample_key\":\"sample_value\"},\"priority\":\"sample_object_priority\",\"version\":123,\"idempotencyStrategy\":{\"values\":[\"FAIL\",\"RETURN_EXISTING\",\"FAIL_ON_RUNNING\"],\"constants\":{\"FAIL_ON_RUNNING\":\"(2)\",\"RETURN_EXISTING\":\"(1)\",\"FAIL\":\"(0)\"},\"sampleValue\":\"FAIL\"}},\"optional\":true,\"joinStatus\":\"sample_joinStatus\",\"evaluatorType\":\"sample_evaluatorType\",\"dynamicTaskNameParam\":\"sample_dynamicTaskNameParam\",\"name\":\"sample_name\",\"startDelay\":123,\"permissive\":true,\"taskReferenceName\":\"sample_taskReferenceName\",\"defaultCase\":[],\"forkTasks\":[[]],\"dynamicForkTasksParam\":\"sample_dynamicForkTasksParam\"}],\"forkTasks\":[[{\"joinOn\":[\"sample_joinOn\"],\"description\":\"sample_description\",\"scriptExpression\":\"sample_scriptExpression\",\"cacheConfig\":{\"key\":\"sample_key\",\"ttlInSecond\":123},\"type\":\"sample_type\",\"inputParameters\":{\"sample_key\":\"sample_value\"},\"decisionCases\":{},\"loopOver\":[],\"caseExpression\":\"sample_caseExpression\",\"defaultExclusiveJoinTask\":[\"sample_defaultExclusiveJoinTask\"],\"taskDefinition\":{\"timeoutPolicy\":{\"values\":[\"RETRY\",\"TIME_OUT_WF\",\"ALERT_ONLY\"],\"constants\":{\"ALERT_ONLY\":\"(2)\",\"TIME_OUT_WF\":\"(1)\",\"RETRY\":\"(0)\"},\"sampleValue\":\"RETRY\"},\"inputKeys\":[\"sample_inputKeys\"],\"concurrentExecLimit\":123,\"isolationGroupId\":\"sample_isolationGroupId\",\"retryCount\":123,\"description\":\"sample_description\",\"inputTemplate\":{\"sample_key\":\"sample_value\"},\"ownerEmail\":\"sample_ownerEmail\",\"baseType\":\"sample_baseType\",\"totalTimeoutSeconds\":123,\"retryDelaySeconds\":123,\"backoffScaleFactor\":123,\"rateLimitPerFrequency\":123,\"retryLogic\":{\"values\":[\"FIXED\",\"EXPONENTIAL_BACKOFF\",\"LINEAR_BACKOFF\"],\"constants\":{\"EXPONENTIAL_BACKOFF\":\"(1)\",\"FIXED\":\"(0)\",\"LINEAR_BACKOFF\":\"(2)\"},\"sampleValue\":\"FIXED\"},\"responseTimeoutSeconds\":123,\"name\":\"sample_name\",\"timeoutSeconds\":123,\"rateLimitFrequencyInSeconds\":123,\"outputKeys\":[\"sample_outputKeys\"],\"executionNameSpace\":\"sample_executionNameSpace\",\"pollTimeoutSeconds\":123},\"caseValueParam\":\"sample_caseValueParam\",\"dynamicForkTasksInputParamName\":\"sample_dynamicForkTasksInputParamName\",\"expression\":\"sample_expression\",\"loopCondition\":\"sample_loopCondition\",\"asyncComplete\":true,\"sink\":\"sample_sink\",\"rateLimited\":true,\"retryCount\":123,\"subWorkflowParam\":{\"workflowDefinition\":\"sample_workflowDefinition\",\"idempotencyKey\":\"sample_idempotencyKey\",\"name\":\"sample_name\",\"taskToDomain\":{\"sample_key\":\"sample_value\"},\"priority\":\"sample_object_priority\",\"version\":123,\"idempotencyStrategy\":{\"values\":[\"FAIL\",\"RETURN_EXISTING\",\"FAIL_ON_RUNNING\"],\"constants\":{\"FAIL_ON_RUNNING\":\"(2)\",\"RETURN_EXISTING\":\"(1)\",\"FAIL\":\"(0)\"},\"sampleValue\":\"FAIL\"}},\"optional\":true,\"joinStatus\":\"sample_joinStatus\",\"evaluatorType\":\"sample_evaluatorType\",\"dynamicTaskNameParam\":\"sample_dynamicTaskNameParam\",\"name\":\"sample_name\",\"startDelay\":123,\"permissive\":true,\"taskReferenceName\":\"sample_taskReferenceName\",\"defaultCase\":[],\"forkTasks\":[[]],\"dynamicForkTasksParam\":\"sample_dynamicForkTasksParam\"}]],\"dynamicForkTasksParam\":\"sample_dynamicForkTasksParam\"}";
        ObjectMapper objectMapper = new ObjectMapper();
        WorkflowTask workflowTask = objectMapper.readValue(serverJSON, WorkflowTask.class);

        Assertions.assertEquals("sample_description", workflowTask.getDescription());
        Assertions.assertEquals("sample_scriptExpression", workflowTask.getScriptExpression());
        Assertions.assertEquals("sample_key", workflowTask.getCacheConfig().getKey());
        Assertions.assertEquals(123, workflowTask.getCacheConfig().getTtlInSecond());
        Assertions.assertEquals("sample_type", workflowTask.getType());
        Assertions.assertEquals("sample_value", workflowTask.getInputParameters().get("sample_key"));
        Assertions.assertTrue(workflowTask.getDecisionCases().containsKey("sample_key"));
        Assertions.assertEquals(1, workflowTask.getDecisionCases().get("sample_key").size());
        WorkflowTask nestedTask = workflowTask.getDecisionCases().get("sample_key").get(0);
        Assertions.assertEquals("sample_caseExpression", nestedTask.getCaseExpression());
        Assertions.assertEquals("RETRY", nestedTask.getTaskDefinition().getTimeoutPolicy().getSampleValue());
        Assertions.assertTrue(nestedTask.isAsyncComplete());
        Assertions.assertEquals("FAIL", nestedTask.getSubWorkflowParam().getIdempotencyStrategy().getSampleValue());

        String serializedJSON = objectMapper.writeValueAsString(workflowTask);
        JsonNode originalJsonNode = objectMapper.readTree(serverJSON);
        JsonNode serializedJsonNode = objectMapper.readTree(serializedJSON);
        Assertions.assertEquals(originalJsonNode, serializedJsonNode);
    }
}