<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Task Domains - Conductor</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/custom.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Task Domains";
    var mkdocs_page_input_path = "configuration/taskdomains.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Conductor</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../architecture/">Architecture</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../gettingstarted/basicconcepts/">Basic Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../gettingstarted/client/">Using the Client</a>
                </li>
                <li class="">
                    
    <a class="" href="../../gettingstarted/startworkflow/">Start a Workflow</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Configuration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../taskdef/">Task Definition</a>
                </li>
                <li class="">
                    
    <a class="" href="../workflowdef/">Workflow Definition</a>
                </li>
                <li class="">
                    
    <a class="" href="../systask/">System Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../eventhandlers/">Event Handlers</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Task Domains</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#task-domains">Task Domains</a></li>
    

    <li class="toctree-l3"><a href="#how-to-use-task-domains">How to use Task Domains</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#change-the-poll-call">Change the poll call</a></li>
        
            <li><a class="toctree-l4" href="#change-the-start-workflow-call">Change the start workflow call</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../server/">Conductor Server</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../apispec/">API Specification</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Conductor Metrics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../metrics/server/">Server Metrics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../metrics/client/">Client Metrics</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../extend/">Extending Conductor</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../tasklifecycle/">Task Lifecycle</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../externalpayloadstorage/">External Payload Storage</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developer Labs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../labs/beginner/">Beginner</a>
                </li>
                <li class="">
                    
    <a class="" href="../../labs/eventhandlers/">Events and Event Handlers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../labs/kitchensink/">Kitchensink</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../bestpractices/">Best Practices</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../license/">License</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Conductor</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Configuration &raquo;</li>
        
      
    
    <li>Task Domains</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Netflix/conductor/edit/dev/docs/docs/configuration/taskdomains.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="task-domains">Task Domains<a class="headerlink" href="#task-domains" title="Permanent link">&para;</a></h2>
<p>Task domains helps support task development. The idea is same “task definition” can be implemented in different “domains”. A domain is some arbitrary name that the developer controls. So when the workflow is started, the caller can specify, out of all the tasks in the workflow, which tasks need to run in a specific domain, this domain is then used to poll for task on the client side to execute it.  </p>
<p>As an example if a workflow (WF1) has 3 tasks T1, T2, T3. The workflow is deployed and working fine, which means there are T2 workers polling and executing. If you modify T2 and run it locally there is no guarantee that your modified T2 worker will get the task that you are looking for as it coming from the general T2 queue. “Task Domain” feature solves this problem by splitting the T2 queue by domains, so when the app polls for task T2 in a specific domain, it get the correct task.</p>
<p>When starting a workflow multiple domains can be specified as a fall backs, for example "domain1,domain2". Conductor keeps track of last polling time for each task, so in this case it checks if the there are any active workers for "domain1" then the task is put in "domain1", if not then the same check is done for the next domain in sequence "domain2" and so on.</p>
<p>If no workers are active for the domains provided:</p>
<ul>
<li>If <code>NO_DOMAIN</code> is provided as last token in list of domains, then no domain is set.</li>
<li>Else, task will be added to last inactive domain in list of domains, hoping that workers would soon be available for that domain.</li>
</ul>
<p>Also, a <code>*</code> token can be used to apply domains for all tasks. This can be overridden by providing task specific mappings along with <code>*</code>. </p>
<p>For example, the below configuration:</p>
<pre class="codehilite"><code class="language-json">&quot;taskToDomain&quot;: {
  &quot;*&quot;: &quot;mydomain&quot;,
  &quot;some_task_x&quot;:&quot;NO_DOMAIN&quot;,
  &quot;some_task_y&quot;: &quot;someDomain, NO_DOMAIN&quot;,
  &quot;some_task_z&quot;: &quot;someInactiveDomain1, someInactiveDomain2&quot;
}</code></pre>


<ul>
<li>puts <code>some_task_x</code> in default queue (no domain).</li>
<li>puts <code>some_task_y</code> in <code>someDomain</code> domain, if available or in default otherwise.</li>
<li>puts <code>some_task_z</code> in <code>someInactiveDomain2</code>, even though workers are not available yet.</li>
<li>and puts all other tasks in <code>mydomain</code> (even if workers are not available).</li>
</ul>
<p><b>Note</b> that this "fall back" type domain strings can only be used when starting the workflow, when polling from the client only one domain is used. Also, <code>NO_DOMAIN</code> token should be used last.</p>
<h2 id="how-to-use-task-domains">How to use Task Domains<a class="headerlink" href="#how-to-use-task-domains" title="Permanent link">&para;</a></h2>
<h3 id="change-the-poll-call">Change the poll call<a class="headerlink" href="#change-the-poll-call" title="Permanent link">&para;</a></h3>
<p>The poll call must now specify the domain. </p>
<h4 id="java-client">Java Client<a class="headerlink" href="#java-client" title="Permanent link">&para;</a></h4>
<p>If you are using the java client then a simple property change will force  WorkflowTaskCoordinator to pass the domain to the poller.</p>
<pre class="codehilite"><code>    conductor.worker.T2.domain=mydomain //Task T2 needs to poll for domain &quot;mydomain&quot;</code></pre>


<h4 id="rest-call">REST call<a class="headerlink" href="#rest-call" title="Permanent link">&para;</a></h4>
<p><code>GET /tasks/poll/batch/T2?workerid=myworker&amp;domain=mydomain</code>
<code>GET /tasks/poll/T2?workerid=myworker&amp;domain=mydomain</code></p>
<h3 id="change-the-start-workflow-call">Change the start workflow call<a class="headerlink" href="#change-the-start-workflow-call" title="Permanent link">&para;</a></h3>
<p>When starting the workflow, make sure the task to domain mapping is passes</p>
<h4 id="java-client_1">Java Client<a class="headerlink" href="#java-client_1" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code>    Map&lt;String, Object&gt; input = new HashMap&lt;&gt;();
    input.put(&quot;wf_input1&quot;, &quot;one”);

    Map&lt;String, String&gt; taskToDomain = new HashMap&lt;&gt;();
    taskToDomain.put(&quot;T2&quot;, &quot;mydomain&quot;);

    // Other options ...
    // taskToDomain.put(&quot;*&quot;, &quot;mydomain, NO_DOMAIN&quot;)
    // taskToDomain.put(&quot;T2&quot;, &quot;mydomain, fallbackDomain1, fallbackDomain2&quot;)

    StartWorkflowRequest swr = new StartWorkflowRequest();
    swr.withName(“myWorkflow”)
        .withCorrelationId(“corr1”)
        .withVersion(1)
        .withInput(input)
        .withTaskToDomain(taskToDomain);

    wfclient.startWorkflow(swr);</code></pre>


<h4 id="rest-call_1">REST call<a class="headerlink" href="#rest-call_1" title="Permanent link">&para;</a></h4>
<p><code>POST /workflow</code></p>
<pre class="codehilite"><code class="language-json">{
  &quot;name&quot;: &quot;myWorkflow&quot;,
  &quot;version&quot;: 1,
  &quot;correlatonId&quot;: &quot;corr1&quot;
  &quot;input&quot;: {
    &quot;wf_input1&quot;: &quot;one&quot;
  },
  &quot;taskToDomain&quot;: {
    &quot;*&quot;: &quot;mydomain&quot;,
    &quot;some_task_x&quot;:&quot;NO_DOMAIN&quot;,
    &quot;some_task_y&quot;: &quot;someDomain, NO_DOMAIN&quot;
  }
}</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../server/" class="btn btn-neutral float-right" title="Conductor Server">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../eventhandlers/" class="btn btn-neutral" title="Event Handlers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Netflix/conductor/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../eventhandlers/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../server/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
